import{r as o,u as L,j as e,d as N,v as b,x as y,bc as w,z as C,e as k,ax as h,ay as D,az as g,aA as u,aa as F,ad as V,P as _,a as P,c1 as $,s as c,V as R,c2 as W,c3 as Y,c4 as K}from"./index-BPC64rrb.js";function B(){const[d,r]=o.useState("idle"),[j,a]=o.useState(""),[p,t]=o.useState([]),[l,S]=o.useState(""),[f,q]=o.useState(!1),[m,v]=o.useState([]),[A,E]=o.useState(!1),{toast:I}=L(),M=async()=>{r("checking"),t([]),v([]);try{if(a("Verificando extensión de firma digital..."),!await W()){r("error"),a("La extensión de firma digital no está disponible"),t(["✖ La extensión de firma digital no está instalada o habilitada","➤ Por favor, instale la extensión PKCS#11 para su navegador","➤ Si ya está instalada, verifique que esté habilitada en la configuración de extensiones"]),E(!0);return}t(n=>[...n,"✓ Extensión de firma digital detectada correctamente"]),a("Detectando dispositivos de firma digital...");const i=await Y();if(i.length===0){r("error"),a("No se detectaron dispositivos de firma digital"),t(n=>[...n,"✖ No se detectaron dispositivos de firma digital conectados","➤ Verifique que su dispositivo esté correctamente conectado","➤ Si está usando una tarjeta inteligente, asegúrese de que el lector esté bien conectado"]);return}t(n=>[...n,`✓ Se detectaron ${i.length} dispositivo(s) de firma digital`,...i.map(z=>`  • ${z}`)]),q(!0),a("Ingrese el PIN para continuar con el diagnóstico"),r("idle")}catch(s){r("error"),a(`Error durante el diagnóstico: ${s.message}`),t(i=>[...i,`✖ Error: ${s.message}`])}},T=async()=>{if(!l){I({title:"Error",description:"Debe ingresar un PIN para continuar",variant:"destructive"});return}r("checking"),a("Verificando certificados digitales...");try{const s=await K(l);if(v(s),s.length===0){r("error"),a("No se encontraron certificados válidos"),t(i=>[...i,"✖ No se encontraron certificados digitales válidos en el dispositivo","➤ Verifique que su dispositivo contenga certificados instalados","➤ El PIN proporcionado podría ser incorrecto"]);return}t(i=>[...i,`✓ Se encontraron ${s.length} certificado(s) digital(es):`,...s.map(n=>`  • ${n.subject} (Válido hasta: ${x(n.validTo)})`)]),r("success"),a("Diagnóstico completado con éxito")}catch(s){r("error"),a(`Error al verificar certificados: ${s.message}`),t(i=>[...i,`✖ Error: ${s.message}`]),s.message.toLowerCase().includes("pin")&&t(i=>[...i,"➤ Es posible que el PIN sea incorrecto"])}},x=s=>s.toLocaleDateString("es-CL",{year:"numeric",month:"long",day:"numeric"});return e.jsxs("div",{className:"container max-w-4xl mx-auto py-8 space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Diagnóstico de eToken"}),e.jsx("p",{className:"text-gray-600",children:"Esta herramienta verifica el correcto funcionamiento de su dispositivo de firma electrónica (eToken) y proporciona información detallada sobre el estado del sistema."}),e.jsxs(N,{children:[e.jsxs(b,{children:[e.jsxs(y,{className:"flex items-center",children:[e.jsx(w,{className:"h-5 w-5 text-indigo-600 mr-2"}),"Herramienta de Diagnóstico"]}),e.jsx(C,{children:"Analiza el estado de su dispositivo de firma electrónica y muestra información detallada"})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-md",children:[e.jsx("h3",{className:"font-medium text-slate-800 mb-2",children:"Información importante"}),e.jsx("p",{className:"text-sm text-slate-700",children:"Esta herramienta verifica:"}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-slate-700 space-y-1 mt-2 ml-2",children:[e.jsx("li",{children:"La presencia de la extensión PKCS#11 en su navegador"}),e.jsx("li",{children:"La detección correcta de los dispositivos criptográficos conectados"}),e.jsx("li",{children:"El acceso a los certificados almacenados en su eToken o smartcard"}),e.jsx("li",{children:"La validez de los certificados digitales"})]})]}),d==="error"&&e.jsxs(h,{className:"bg-red-50 border-red-200",children:[e.jsx(D,{className:"h-4 w-4 text-red-600"}),e.jsx(g,{className:"text-red-800",children:"Problema detectado"}),e.jsx(u,{className:"text-red-700",children:j})]}),d==="success"&&e.jsxs(h,{className:"bg-green-50 border-green-200",children:[e.jsx(F,{className:"h-4 w-4 text-green-600"}),e.jsx(g,{className:"text-green-800",children:"Diagnóstico exitoso"}),e.jsx(u,{className:"text-green-700",children:j})]}),f&&e.jsxs("div",{className:"space-y-2 my-4 p-4 border border-indigo-100 bg-indigo-50 rounded-md",children:[e.jsx(V,{htmlFor:"pin",className:"text-indigo-900",children:"PIN de acceso"}),e.jsx(_,{id:"pin",type:"password",placeholder:"Ingrese el PIN de su dispositivo",value:l,onChange:s=>S(s.target.value),className:"border-indigo-200"}),e.jsx("p",{className:"text-xs text-indigo-700 mt-1",children:"El PIN es necesario para acceder a los certificados de su dispositivo. Su PIN no se almacena ni se transmite a ningún servidor."}),e.jsx(P,{onClick:T,disabled:d==="checking"||!l,className:"mt-2 bg-indigo-600 hover:bg-indigo-700",children:d==="checking"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white rounded-full border-t-transparent mr-2"}),"Verificando certificados..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Verificar certificados"]})})]}),p.length>0&&e.jsxs("div",{className:"border rounded-md p-4 bg-slate-50",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Resultados del diagnóstico:"}),e.jsx("div",{className:"font-mono text-sm whitespace-pre-wrap",children:p.map((s,i)=>e.jsx("div",{className:s.startsWith("✓")?"text-green-600":s.startsWith("✖")?"text-red-600":s.startsWith("➤")?"text-blue-600":s.startsWith("  •")?"text-gray-600 ml-4":"",children:s},i))})]}),A&&e.jsxs("div",{className:"mt-6 border border-indigo-200 rounded-md overflow-hidden",children:[e.jsx("div",{className:"bg-indigo-100 p-4 border-b border-indigo-200",children:e.jsxs("h3",{className:"font-medium text-indigo-900 flex items-center",children:[e.jsx(c,{className:"h-5 w-5 mr-2 text-indigo-700"}),"Descargar extensión de firma digital"]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-700",children:"Para utilizar firma digital avanzada, necesita instalar la extensión PKCS#11 en su navegador:"}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("div",{className:"border rounded p-3 flex items-center hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"bg-blue-600 h-10 w-10 mr-3 rounded-full flex items-center justify-center text-white text-xl font-bold",children:"C"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h4",{className:"font-medium",children:"Extensión para Google Chrome"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Compatible con Chrome, Edge, Brave y otros navegadores basados en Chromium"})]}),e.jsxs("a",{href:"https://chrome.google.com/webstore/detail/etoken-chile/bjiggnkkapmcoaemgbojjbbkejobfgnn",target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-sm bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors inline-flex items-center",children:[e.jsx(c,{className:"h-4 w-4 mr-1"}),"Descargar"]})]}),e.jsxs("div",{className:"border rounded p-3 flex items-center hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"bg-orange-500 h-10 w-10 mr-3 rounded-full flex items-center justify-center text-white text-xl font-bold",children:"F"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h4",{className:"font-medium",children:"Extensión para Mozilla Firefox"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Para navegadores Firefox"})]}),e.jsxs("a",{href:"https://addons.mozilla.org/es/firefox/addon/firmador-electronico-chile/",target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-sm bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors inline-flex items-center",children:[e.jsx(c,{className:"h-4 w-4 mr-1"}),"Descargar"]})]}),e.jsxs("div",{className:"border rounded p-3 flex items-center hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"bg-gray-800 h-10 w-10 mr-3 rounded-full flex items-center justify-center text-white text-xl font-bold",children:"D"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h4",{className:"font-medium",children:"SafeNet Authentication Client"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Controladores y software esencial para dispositivos eToken"})]}),e.jsxs("a",{href:"https://download.thalesesecurity.com/download?_ga=2.24517332.337417403.1673970743-1895204286.1673970743&_gl=1*1xmfteu*_ga*MTg5NTIwNDI4Ni4xNjczOTcwNzQz*_ga_PLJ5S4M5FR*MTY3Mzk3MDc0Mi4xLjAuMTY3Mzk3MDc0Mi4wLjAuMA..*_ga_CDHY7NPMWW*MTY3Mzk3MDc0Mi4xLjAuMTY3Mzk3MDc0Mi4wLjAuMA..#/download/get-link?productId=safenet-authentication-client-download-windows",target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-sm bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors inline-flex items-center",children:[e.jsx(c,{className:"h-4 w-4 mr-1"}),"Descargar"]})]})]}),e.jsxs(h,{className:"mt-4 bg-yellow-50 border-yellow-200",children:[e.jsx(D,{className:"h-4 w-4 text-yellow-600"}),e.jsx(g,{className:"text-yellow-800",children:"Información importante"}),e.jsx(u,{className:"text-yellow-700",children:"Después de instalar la extensión, reinicie su navegador y vuelva a ejecutar el diagnóstico."})]})]})]}),m.length>0&&e.jsxs("div",{className:"border rounded-md mt-4",children:[e.jsxs("div",{className:"bg-indigo-50 p-3 border-b border-indigo-100 font-medium",children:["Certificados encontrados (",m.length,")"]}),e.jsx("div",{className:"divide-y",children:m.map((s,i)=>e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"font-medium",children:s.subject}),e.jsxs("div",{className:"mt-1 space-y-1 text-sm",children:[e.jsxs("p",{className:"text-gray-600",children:["Emisor: ",s.issuer]}),e.jsxs("p",{className:"text-gray-600",children:["Válido desde: ",x(s.validFrom)," hasta: ",x(s.validTo)]}),e.jsxs("p",{className:"text-gray-500 font-mono text-xs truncate",children:["Número de serie: ",s.serialNumber]}),e.jsxs("p",{className:"text-gray-600",children:["Proveedor: ",s.provider]})]})]},i))})]})]}),e.jsx(R,{children:e.jsx(P,{onClick:M,disabled:d==="checking",className:"bg-indigo-600 hover:bg-indigo-700",children:d==="checking"&&!f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white rounded-full border-t-transparent mr-2"}),"Ejecutando diagnóstico..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),"Iniciar diagnóstico"]})})})]}),e.jsxs(N,{children:[e.jsxs(b,{children:[e.jsx(y,{children:"Solución de problemas comunes"}),e.jsx(C,{children:"Guía para resolver los problemas más frecuentes con dispositivos de firma digital"})]}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:"La extensión no se detecta"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[e.jsx("li",{children:"Verifique que ha instalado la extensión PKCS#11 desde la tienda de extensiones de su navegador"}),e.jsx("li",{children:"Asegúrese de que la extensión está habilitada en su navegador"}),e.jsx("li",{children:"Algunos navegadores requieren permisos adicionales para este tipo de extensiones"}),e.jsx("li",{children:"Intente reiniciar el navegador después de instalar la extensión"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:"No se detectan dispositivos"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[e.jsx("li",{children:"Verifique que el dispositivo está correctamente conectado al equipo"}),e.jsx("li",{children:"Intente desconectar y volver a conectar el dispositivo"}),e.jsx("li",{children:"Compruebe que los controladores del dispositivo están instalados en su sistema"}),e.jsx("li",{children:"Algunos sistemas requieren software adicional para detectar ciertos tipos de tokens"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:"Problemas con el PIN"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[e.jsx("li",{children:"Asegúrese de estar utilizando el PIN correcto para su dispositivo"}),e.jsx("li",{children:"Si ha olvidado el PIN, contacte con el proveedor de su token"}),e.jsx("li",{children:"Tenga en cuenta que después de varios intentos fallidos, el dispositivo puede bloquearse"}),e.jsx("li",{children:"Algunos dispositivos distinguen entre mayúsculas y minúsculas en el PIN"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:"Certificados no válidos o expirados"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[e.jsx("li",{children:"Verifique la fecha de expiración de sus certificados"}),e.jsx("li",{children:"Si han expirado, contacte con su proveedor de certificados para renovarlos"}),e.jsx("li",{children:"Asegúrese de que la fecha y hora de su sistema sean correctas"}),e.jsx("li",{children:"Algunos certificados requieren una conexión a internet para verificar su validez"})]})]})]})})]})]})}export{B as default};
