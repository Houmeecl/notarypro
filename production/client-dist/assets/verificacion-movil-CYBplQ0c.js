import{bK as Q,p as W,u as G,r as c,j as e,d as J,v as Z,x as _,z as $,e as ee,V as se,a as t,ab as ae,ax as p,ay as T,az as j,aA as v,aB as R,af as re,bN as te,bl as ce,bc as ie,U as ne,bh as A}from"./index-BPC64rrb.js";import{v as le}from"./vecino-xpress-logo-nuevo-B8CWszsf.js";function me(){const g=Q(),d=g==null?void 0:g.sessionId;W();const{toast:o}=G(),[l,r]=c.useState("instructions"),[h,y]=c.useState(null),[f,C]=c.useState(null),[F,S]=c.useState(!1),[k,b]=c.useState(0),[m,V]=c.useState(null),i=c.useRef(null),N=c.useRef(null),n=c.useRef(null);c.useEffect(()=>{if(!d){o({title:"Error de sesión",description:"No se proporcionó un ID de sesión válido",variant:"destructive"});return}return console.log("Iniciando sesión de verificación:",d),()=>{n.current&&n.current.getTracks().forEach(s=>s.stop())}},[d,o]);const u=async(s=!1)=>{try{n.current&&n.current.getTracks().forEach(K=>K.stop());const a={video:{facingMode:s?"user":"environment",width:{ideal:1920},height:{ideal:1080}}},x=await navigator.mediaDevices.getUserMedia(a);n.current=x,i.current&&(i.current.srcObject=x,await i.current.play())}catch(a){console.error("Error al acceder a la cámara:",a),o({title:"Error de cámara",description:"No se pudo acceder a la cámara. Verifique los permisos.",variant:"destructive"})}},w=()=>{n.current&&(n.current.getTracks().forEach(s=>s.stop()),n.current=null),i.current&&(i.current.srcObject=null)},D=()=>{if(!i.current||!N.current)return null;const s=i.current,a=N.current;a.width=s.videoWidth,a.height=s.videoHeight;const x=a.getContext("2d");return x?(x.drawImage(s,0,0,a.width,a.height),a.toDataURL("image/jpeg",.95)):null},L=()=>{const s=D();s&&(y(s),w(),r("selfie"))},z=()=>{const s=D();s&&(C(s),w(),r("processing"),E())},E=async()=>{if(!h||!f){o({title:"Error",description:"Se requieren imágenes de documento y selfie para la verificación",variant:"destructive"});return}S(!0),b(0);try{const s=setInterval(()=>{b(a=>a>=90?(clearInterval(s),a):a+10)},500);setTimeout(()=>{clearInterval(s),b(100),V({success:!0,message:"Verificación completada correctamente",score:.95}),r("completed"),console.log("Verificación completada para sesión:",d)},5e3)}catch(s){console.error("Error al procesar verificación:",s),V({success:!1,message:s instanceof Error?s.message:"Error desconocido en la verificación"}),o({title:"Error de verificación",description:"No se pudo completar el proceso de verificación",variant:"destructive"})}finally{S(!1)}},I=()=>{y(null),r("document"),u(!1)},M=()=>{C(null),r("selfie"),u(!0)},B=()=>{r("document"),u(!1)},U=()=>{r("selfie"),u(!0)},P=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx(j,{children:"Importante"}),e.jsxs(v,{children:["Para completar la verificación de identidad, necesitará:",e.jsxs("ul",{className:"list-disc pl-5 mt-2 space-y-1",children:[e.jsx("li",{children:"Su cédula de identidad o pasaporte"}),e.jsx("li",{children:"Buena iluminación"}),e.jsx("li",{children:"Cámara de su dispositivo móvil"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-[#4863f7] text-white rounded-full h-6 w-6 flex items-center justify-center shrink-0 mt-0.5",children:"1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-1",children:"Capture su documento de identidad"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Tome una foto clara de su cédula de identidad o pasaporte. Asegúrese de que toda la información sea legible."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-[#4863f7] text-white rounded-full h-6 w-6 flex items-center justify-center shrink-0 mt-0.5",children:"2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-1",children:"Tome una selfie"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Capture una imagen clara de su rostro mirando directamente a la cámara."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-[#4863f7] text-white rounded-full h-6 w-6 flex items-center justify-center shrink-0 mt-0.5",children:"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-1",children:"Verificación automática"}),e.jsx("p",{className:"text-sm text-gray-600",children:"El sistema verificará automáticamente su identidad comparando su selfie con su documento."})]})]})]}),e.jsx(t,{className:"w-full bg-[#2d219b] hover:bg-[#241a7d] text-white",onClick:B,children:"Comenzar Verificación"})]}),q=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{className:"bg-blue-50 border-blue-200",children:[e.jsx(A,{className:"h-4 w-4 text-blue-700"}),e.jsx(j,{children:"Captura de Documento"}),e.jsx(v,{children:"Posicione su cédula de identidad o pasaporte en el recuadro y tome una foto clara."})]}),e.jsx("div",{className:"relative",children:h?e.jsx("div",{className:"rounded-lg overflow-hidden border",children:e.jsx("img",{src:h,alt:"Documento capturado",className:"w-full h-auto"})}):e.jsxs("div",{className:"rounded-lg overflow-hidden bg-black aspect-video relative",children:[e.jsx("video",{ref:i,className:"w-full h-full object-cover",playsInline:!0,autoPlay:!0}),e.jsx("div",{className:"absolute inset-0 border-2 border-white border-opacity-70 rounded m-4 pointer-events-none"}),e.jsx("div",{className:"absolute bottom-4 right-4",children:e.jsxs(t,{size:"sm",variant:"secondary",className:"bg-white/80 hover:bg-white",onClick:()=>{var s,a;return u(!((a=(s=n.current)==null?void 0:s.getVideoTracks()[0].getSettings().facingMode)!=null&&a.includes("user")))},children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Cambiar"]})})]})}),e.jsx("canvas",{ref:N,className:"hidden"}),h?e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(t,{variant:"outline",className:"flex-1",onClick:I,children:"Volver a Capturar"}),e.jsx(t,{className:"flex-1 bg-[#2d219b] hover:bg-[#241a7d] text-white",onClick:U,children:"Continuar"})]}):e.jsx(t,{className:"w-full bg-[#2d219b] hover:bg-[#241a7d] text-white",onClick:L,children:"Capturar Documento"})]}),H=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{className:"bg-blue-50 border-blue-200",children:[e.jsx(ne,{className:"h-4 w-4 text-blue-700"}),e.jsx(j,{children:"Captura de Selfie"}),e.jsx(v,{children:"Centre su rostro en el recuadro, asegurándose de tener buena iluminación."})]}),e.jsx("div",{className:"relative",children:f?e.jsx("div",{className:"rounded-lg overflow-hidden border",children:e.jsx("img",{src:f,alt:"Selfie capturada",className:"w-full h-auto"})}):e.jsxs("div",{className:"rounded-lg overflow-hidden bg-black aspect-video relative",children:[e.jsx("video",{ref:i,className:"w-full h-full object-cover",playsInline:!0,autoPlay:!0}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"border-2 border-white border-opacity-70 rounded-full w-64 h-64 max-w-full"})})]})}),f?e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(t,{variant:"outline",className:"flex-1",onClick:M,children:"Volver a Capturar"}),e.jsx(t,{className:"flex-1 bg-[#2d219b] hover:bg-[#241a7d] text-white",onClick:()=>{r("processing"),E()},children:"Verificar Identidad"})]}):e.jsx(t,{className:"w-full bg-[#2d219b] hover:bg-[#241a7d] text-white",onClick:z,children:"Capturar Selfie"})]}),O=()=>e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"flex flex-col items-center py-8",children:F?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx(te,{className:"h-16 w-16 text-[#2d219b] animate-spin"})}),e.jsx("h3",{className:"text-xl font-medium text-center mb-2",children:"Procesando Verificación"}),e.jsx("p",{className:"text-center text-gray-600 mb-6 max-w-xs",children:"Estamos verificando su identidad. Esto puede tomar un momento."}),e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx(ce,{value:k,className:"h-2"}),e.jsxs("p",{className:"text-xs text-center mt-2 text-gray-500",children:[k,"% Completado"]})]})]}):m?m.success?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-full p-6 mb-6",children:e.jsx(R,{className:"h-16 w-16 text-green-600"})}),e.jsx("h3",{className:"text-xl font-medium text-center mb-2",children:"Verificación Exitosa"}),e.jsx("p",{className:"text-center text-gray-600 mb-6 max-w-xs",children:"Su identidad ha sido verificada correctamente."}),m.score!==void 0&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx(ie,{className:"h-5 w-5 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium",children:["Score de verificación: ",Math.round(m.score*100),"%"]})]}),e.jsx(t,{className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>r("completed"),children:"Continuar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-full p-6 mb-6",children:e.jsx(T,{className:"h-16 w-16 text-red-600"})}),e.jsx("h3",{className:"text-xl font-medium text-center mb-2",children:"Verificación Fallida"}),e.jsx("p",{className:"text-center text-red-600 mb-6 max-w-xs",children:m.message}),e.jsx("div",{className:"flex space-x-3",children:e.jsx(t,{variant:"outline",onClick:I,children:"Reintentar"})})]}):null})}),X=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex flex-col items-center py-8",children:[e.jsx("div",{className:"bg-green-50 border border-green-100 rounded-full p-6 mb-6",children:e.jsx(R,{className:"h-16 w-16 text-green-600"})}),e.jsx("h3",{className:"text-xl font-medium text-center mb-2",children:"¡Proceso Completado!"}),e.jsx("p",{className:"text-center text-gray-600 mb-8 max-w-xs",children:"Su identidad ha sido verificada correctamente. Puede regresar a la aplicación principal."}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg w-full max-w-xs mb-6 text-center",children:[e.jsx("p",{className:"text-gray-500 text-sm mb-1",children:"ID de verificación"}),e.jsx("p",{className:"font-mono text-xs bg-gray-100 p-2 rounded",children:d})]}),e.jsxs(p,{className:"bg-blue-50 border-blue-200",children:[e.jsx(re,{className:"h-4 w-4 text-blue-700"}),e.jsx(j,{children:"¿Qué sigue?"}),e.jsx(v,{children:"Ya puede cerrar esta ventana y continuar con su trámite en la aplicación principal."})]})]})}),Y=()=>{switch(l){case"instructions":return P();case"document":return q();case"selfie":return H();case"processing":return O();case"completed":return X();default:return P()}};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("img",{src:le,alt:"VecinoXpress Logo",className:"h-10"})})})}),e.jsx("main",{className:"flex-1 container mx-auto px-4 py-6",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(J,{children:[e.jsxs(Z,{children:[e.jsx(_,{children:"Verificación de Identidad"}),e.jsx($,{children:"Complete los siguientes pasos para verificar su identidad"})]}),e.jsx(ee,{children:Y()}),l!=="instructions"&&l!=="processing"&&l!=="completed"&&e.jsx(se,{children:e.jsxs(t,{variant:"ghost",size:"sm",className:"text-gray-500",onClick:()=>{l==="document"?r("instructions"):l==="selfie"&&r("document"),w()},children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Volver"]})})]})})}),e.jsx("footer",{className:"bg-white border-t border-gray-200 py-4 mt-auto",children:e.jsxs("div",{className:"container mx-auto px-4 text-center text-gray-600 text-sm",children:["© ",new Date().getFullYear()," VecinoXpress - Todos los derechos reservados"]})})]})}export{me as default};
