import{r as a,u as T,j as e,d as S,v as R,ag as w,x as F,B,z as Q,e as I,ax as q,ay as M,az as z,aA as J,a as c,bN as X,bl as Y,V as A,bm as Z,p as _,ab as L,aB as E,bc as $}from"./index-BPC64rrb.js";const ee=({onScanComplete:u,onCancel:n,autoStart:l=!1})=>{const[p,j]=a.useState(!1),[d,f]=a.useState(!1),[y,g]=a.useState(null),[D,o]=a.useState(null),[m,h]=a.useState(0),[i,N]=a.useState(!1),[r,V]=a.useState(null),x=a.useRef(null),v=a.useRef(null),k=a.useRef(null),{toast:b}=T();a.useEffect(()=>(l&&O(),()=>{P()}),[l]),a.useEffect(()=>{i&&r&&W(r)},[i,r]),a.useEffect(()=>{let s;return d&&m<100&&(s=setInterval(()=>{h(t=>{const C=t+10;return C>=100?(clearInterval(s),100):C})},200)),()=>{s&&clearInterval(s)}},[d,m]),a.useEffect(()=>{m===100&&d&&setTimeout(()=>{K()},500)},[m,d]);const O=async()=>{j(!0),N(!1),V(null),o(null),h(0);try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Su navegador no soporta acceso a la cámara.");const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});g(s),x.current&&(x.current.srcObject=s,await x.current.play(),H())}catch(s){console.error("Error al iniciar la cámara:",s),j(!1),o(s instanceof Error?s.message:"Error al acceder a la cámara"),b({title:"Error de cámara",description:"No se pudo acceder a la cámara. Verifique los permisos del navegador.",variant:"destructive"})}},P=()=>{j(!1),y&&(y.getTracks().forEach(s=>s.stop()),g(null)),x.current&&(x.current.srcObject=null),k.current&&(window.clearInterval(k.current),k.current=null)},U=()=>{P(),N(!1),V(null),o(null),h(0),f(!1)},H=()=>{setTimeout(()=>{const s=JSON.stringify({type:"nfc-id-card",serialNumber:"CHL123456789",documentNumber:"12.345.678-9",fullName:"NOMBRE APELLIDO USUARIO",birthDate:"01/01/1980",expiryDate:"31/12/2028",issuingAuthority:"REGISTRO CIVIL E IDENTIFICACIÓN"});N(!0),V(s),b({title:"¡Código QR detectado!",description:"Procesando datos del chip NFC..."}),G()},3e3)},G=()=>{if(!x.current||!v.current)return;const s=x.current,t=v.current;t.width=s.videoWidth,t.height=s.videoHeight;const C=t.getContext("2d");C&&C.drawImage(s,0,0,t.width,t.height)},W=s=>{f(!0),h(0);try{P(),console.log("Procesando datos QR:",s)}catch(t){console.error("Error al procesar datos QR:",t),f(!1),o("Error al procesar el código QR. Formato inválido."),b({title:"Error de procesamiento",description:"No se pudieron procesar los datos del código QR.",variant:"destructive"}),u(null,"Error al procesar el código QR")}},K=()=>{if(f(!1),r)try{const s=JSON.parse(r),t={serialNumber:s.serialNumber||"",documentNumber:s.documentNumber||"",fullName:s.fullName||"",birthDate:s.birthDate||"",expiryDate:s.expiryDate||"",issuingAuthority:s.issuingAuthority||"",verified:!0,timestamp:new Date().toISOString()};b({title:"Verificación completada",description:"Datos NFC validados correctamente."}),u(t)}catch(s){console.error("Error al parsear datos QR:",s),o("Error al parsear los datos del código QR."),b({title:"Error de formato",description:"Los datos del código QR no tienen el formato esperado.",variant:"destructive"}),u(null,"Error de formato en datos QR")}};return e.jsxs(S,{className:"w-full",children:[e.jsxs(R,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-primary"}),e.jsx(F,{children:"Escáner NFC vía QR"})]}),i&&e.jsx(B,{variant:"outline",className:"bg-green-50 text-green-700",children:"QR Detectado"})]}),e.jsx(Q,{children:"Escanee el código QR para validar los datos del chip NFC"})]}),e.jsxs(I,{className:"space-y-4",children:[D&&e.jsxs(q,{variant:"destructive",className:"mb-4",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx(z,{children:"Error"}),e.jsx(J,{children:D})]}),!p&&!d&&!i?e.jsxs("div",{className:"text-center p-6 space-y-4",children:[e.jsx("div",{className:"bg-primary/10 p-6 rounded-full inline-block mb-2",children:e.jsx(w,{className:"h-12 w-12 text-primary"})}),e.jsx("h2",{className:"text-lg font-medium",children:"Escaneo de código QR para NFC"}),e.jsx("p",{className:"text-muted-foreground",children:"Este escáner permite validar los datos del chip NFC de la cédula de identidad a través de un código QR específico."}),e.jsx(c,{onClick:O,className:"w-full mt-2",children:"Iniciar escaneo"})]}):p&&!i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[e.jsx("video",{ref:x,className:"w-full h-[280px] object-cover",autoPlay:!0,playsInline:!0}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-[200px] h-[200px] border-2 border-primary rounded-lg"})})]}),e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"Centre el código QR dentro del recuadro para escanear"})]}):d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4",children:[e.jsx(X,{className:"h-12 w-12 text-primary animate-spin mx-auto mb-2"}),e.jsx("h2",{className:"text-lg font-medium",children:"Procesando datos NFC"}),e.jsx("p",{className:"text-muted-foreground",children:"Validando información del chip NFC..."})]}),e.jsx(Y,{value:m,className:"h-2"}),e.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:[Math.round(m),"% completado"]})]}):i&&r?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx(w,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-green-800",children:"Datos NFC validados"}),e.jsx("p",{className:"text-sm text-green-700",children:"Se ha verificado correctamente la información del chip NFC"})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-3 text-sm",children:r&&e.jsx(e.Fragment,{children:(()=>{try{const s=JSON.parse(r);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Documento:"}),e.jsx("p",{children:s.documentNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Nombre:"}),e.jsx("p",{children:s.fullName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Fecha nacimiento:"}),e.jsx("p",{children:s.birthDate})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Vencimiento:"}),e.jsx("p",{children:s.expiryDate})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"font-medium",children:"Serial NFC:"}),e.jsx("p",{className:"font-mono text-xs",children:s.serialNumber})]})]})}catch(s){return e.jsxs("p",{className:"col-span-2 text-red-500",children:["Error al mostrar datos: ",String(s)]})}})()})})]}),v.current&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Captura de código QR:"}),e.jsx("div",{className:"bg-muted rounded-lg overflow-hidden",children:e.jsx("canvas",{ref:v,className:"w-full h-[150px] object-contain"})})]})]}):null,e.jsx("canvas",{ref:v,className:"hidden"})]}),e.jsxs(A,{className:"flex justify-between border-t pt-4",children:[e.jsx(c,{variant:"outline",onClick:n,children:"Cancelar"}),i&&r?e.jsx(c,{onClick:()=>{try{const s=JSON.parse(r),t={serialNumber:s.serialNumber||"",documentNumber:s.documentNumber||"",fullName:s.fullName||"",birthDate:s.birthDate||"",expiryDate:s.expiryDate||"",issuingAuthority:s.issuingAuthority||"",verified:!0,timestamp:new Date().toISOString()};u(t)}catch(s){console.error("Error al parsear datos QR:",s),o("Error al parsear los datos del código QR."),u(null,"Error de formato en datos QR")}},children:"Continuar"}):p&&!i?e.jsxs(c,{variant:"outline",onClick:U,children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Reiniciar escaneo"]}):!p&&!d&&!i?e.jsx(c,{variant:"ghost",onClick:()=>{O()},children:"Escaneo automático"}):null]})]})},ae=()=>{const[u,n]=a.useState("initial"),[l,p]=a.useState(null),[j,d]=a.useState(null),[f,y]=_(),{toast:g}=T(),D=(N,r)=>{N?(p(N),n("complete"),g({title:"Verificación exitosa",description:"Datos del chip NFC validados correctamente."})):(d(r||"No se pudo verificar el chip NFC."),n("error"),g({title:"Error de verificación",description:r||"No se pudo verificar el chip NFC.",variant:"destructive"}))},o=()=>{n("scanning")},m=()=>{n("initial")},h=()=>{y("/")},i=()=>{switch(u){case"initial":return e.jsxs(S,{className:"w-full max-w-md mx-auto",children:[e.jsxs(R,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-6 w-6 text-primary"}),e.jsx(F,{children:"Verificación NFC vía QR"})]}),e.jsx(Q,{children:"Sistema de validación del chip NFC de la cédula mediante código QR"})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted",children:[e.jsx($,{className:"h-12 w-12 mx-auto mb-2 text-primary"}),e.jsx("h2",{className:"text-lg font-medium mb-1",children:"Validación de seguridad"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Este proceso verificará la autenticidad de su cédula de identidad mediante la lectura del chip NFC."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(E,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Seguridad avanzada"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Verificación de datos oficiales del Registro Civil"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(E,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Proceso simple"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Solo necesita escanear un código QR con la cámara"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(E,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Confidencialidad garantizada"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Los datos personales no se almacenan permanentemente"})]})]})]})]}),e.jsxs(A,{className:"flex-col gap-2",children:[e.jsx(c,{className:"w-full",onClick:o,children:"Iniciar verificación NFC"}),e.jsxs(c,{variant:"outline",className:"w-full",onClick:h,children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Volver"]})]})]});case"scanning":return e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsx(ee,{onScanComplete:D,onCancel:m})});case"complete":return e.jsxs(S,{className:"w-full max-w-md mx-auto",children:[e.jsxs(R,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-6 w-6 text-primary"}),e.jsx(F,{children:"Verificación completada"})]}),e.jsx(B,{variant:"outline",className:"bg-green-50 text-green-700",children:"VERIFICADO"})]}),e.jsx(Q,{children:"Los datos del chip NFC han sido validados correctamente"})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-lg bg-green-50 border border-green-200",children:[e.jsx(E,{className:"h-10 w-10 mx-auto mb-2 text-green-500"}),e.jsx("h2",{className:"text-lg font-medium text-green-700",children:"Validación exitosa"}),e.jsx("p",{className:"text-sm text-green-600",children:"Se ha verificado correctamente la autenticidad de la cédula de identidad"})]}),l&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Datos verificados:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded bg-muted",children:[e.jsx("p",{className:"font-medium",children:"Documento"}),e.jsx("p",{children:l.documentNumber})]}),e.jsxs("div",{className:"p-2 rounded bg-muted",children:[e.jsx("p",{className:"font-medium",children:"Nombre"}),e.jsx("p",{children:l.fullName})]}),e.jsxs("div",{className:"p-2 rounded bg-muted",children:[e.jsx("p",{className:"font-medium",children:"Fecha de nacimiento"}),e.jsx("p",{children:l.birthDate})]}),e.jsxs("div",{className:"p-2 rounded bg-muted",children:[e.jsx("p",{className:"font-medium",children:"Fecha de expiración"}),e.jsx("p",{children:l.expiryDate})]}),e.jsxs("div",{className:"col-span-2 p-2 rounded bg-muted",children:[e.jsx("p",{className:"font-medium",children:"Serial NFC"}),e.jsx("p",{className:"font-mono text-xs",children:l.serialNumber})]}),e.jsxs("div",{className:"col-span-2 p-2 rounded bg-muted",children:[e.jsx("p",{className:"font-medium",children:"Autoridad emisora"}),e.jsx("p",{children:l.issuingAuthority})]})]})]})]}),e.jsxs(A,{className:"flex-col gap-2",children:[e.jsx(c,{className:"w-full",onClick:()=>n("initial"),children:"Nueva verificación"}),e.jsxs(c,{variant:"outline",className:"w-full",onClick:h,children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Finalizar"]})]})]});case"error":return e.jsxs(S,{className:"w-full max-w-md mx-auto",children:[e.jsxs(R,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-6 w-6 text-destructive"}),e.jsx(F,{children:"Error de verificación"})]}),e.jsx(Q,{children:"No se pudo completar la validación del chip NFC"})]}),e.jsxs(I,{children:[e.jsxs(q,{variant:"destructive",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx(z,{children:"Error"}),e.jsx(J,{children:j||"Se produjo un error inesperado durante la verificación."})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Posibles soluciones:"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1 text-sm",children:[e.jsx("li",{children:"Asegúrese de que el código QR sea válido y corresponda al chip NFC de la cédula"}),e.jsx("li",{children:"Intente escanear con buena iluminación y sin reflejos"}),e.jsx("li",{children:"Verifique que su cámara esté funcionando correctamente"}),e.jsx("li",{children:"Si el problema persiste, contacte al soporte técnico"})]})]})]}),e.jsxs(A,{className:"flex-col gap-2",children:[e.jsx(c,{className:"w-full",onClick:()=>n("scanning"),children:"Reintentar"}),e.jsxs(c,{variant:"outline",className:"w-full",onClick:()=>n("initial"),children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Volver"]})]})]})}};return e.jsx("div",{className:"container py-6 max-w-4xl mx-auto",children:e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[80vh]",children:i()})})};export{ae as default};
