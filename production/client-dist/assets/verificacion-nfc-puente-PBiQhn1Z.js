import{o as W,r as s,u as G,j as e,d as C,v as b,x as w,B as U,z as y,e as F,T as B,g as O,h as V,k as A,bm as _,bM as J,cg as P,af as S,a as i,aS as K,bg as X,ch as Y,ax as D,ag as Z,az as Q,aA as L,V as I,p as ee,b$ as se,ay as z,aB as k,bN as ae,G as te,ah as M,bc as ie,bl as re}from"./index-BPC64rrb.js";/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M6 8.32a7.43 7.43 0 0 1 0 7.36",key:"9iaqei"}],["path",{d:"M9.46 6.21a11.76 11.76 0 0 1 0 11.58",key:"1yha7l"}],["path",{d:"M12.91 4.1a15.91 15.91 0 0 1 .01 15.8",key:"4iu2gk"}],["path",{d:"M16.37 2a20.16 20.16 0 0 1 0 20",key:"sap9u2"}]],$=W("nfc",le),ce=({onReadComplete:u,documentInfo:m,sessionId:t="session-"+Math.random().toString(36).substring(2,9)})=>{const[f,h]=s.useState(""),[n,l]=s.useState(""),[p,E]=s.useState("qrcode"),[R,r]=s.useState(!1),[T,q]=s.useState(!0),{toast:c}=G();s.useEffect(()=>{N()},[m,t]);const N=()=>{q(!0);try{const a=`${window.location.origin}/nfc-reader.html?id=${t}&callback=${encodeURIComponent(`${window.location.origin}/verificacion-nfc-puente/result/${t}`)}`,v=`intent://${window.location.host}/nfc-reader.html?id=${t}&callback=${encodeURIComponent(`${window.location.origin}/verificacion-nfc-puente/result/${t}`)}&direct=true#Intent;scheme=https;package=com.android.chrome;end`,j=`web+nfc://read?url=${encodeURIComponent(a)}&direct=true`;h(v),l(a),console.log("URL del lector NFC (web):",a),console.log("URL del lector NFC (Android Intent):",v),console.log("URL del lector NFC (Web NFC Scheme):",j),sessionStorage.setItem(`nfc_url_web_${t}`,a),sessionStorage.setItem(`nfc_url_android_${t}`,v),sessionStorage.setItem(`nfc_url_scheme_${t}`,j),setTimeout(()=>{q(!1)},500)}catch(a){console.error("Error al generar datos QR:",a),c({title:"Error",description:"No se pudo generar el código QR para activación NFC.",variant:"destructive"}),q(!1)}},o=()=>{n&&navigator.clipboard.writeText(n).then(()=>{r(!0),c({title:"Enlace copiado",description:"El enlace de activación NFC ha sido copiado al portapapeles."}),setTimeout(()=>{r(!1)},2e3)}).catch(a=>{console.error("Error al copiar al portapapeles:",a),c({title:"Error",description:"No se pudo copiar el enlace al portapapeles.",variant:"destructive"})})},g=()=>{if(n)try{const a=window.open(n,"_blank");c(a?{title:"Lector NFC abierto",description:"Se ha abierto el lector NFC en una nueva pestaña."}:{title:"No se pudo abrir el lector",description:"Por favor, permita las ventanas emergentes para este sitio.",variant:"destructive"})}catch(a){console.error("Error al abrir el lector NFC:",a),c({title:"Error",description:"No se pudo abrir el lector NFC. Intente escanear el código QR directamente.",variant:"destructive"})}};return e.jsxs(C,{className:"w-full",children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5 text-primary"}),e.jsx(w,{children:"Activación NFC"})]}),e.jsx(U,{variant:"outline",className:"bg-primary/10 text-primary",children:"Paso 1"})]}),e.jsx(y,{children:"Escanee este código QR con su teléfono para activar el lector NFC"})]}),e.jsx(F,{className:"space-y-4",children:e.jsxs(B,{defaultValue:"qrcode",value:p,onValueChange:E,children:[e.jsxs(O,{className:"grid grid-cols-2",children:[e.jsx(V,{value:"qrcode",children:"Código QR"}),e.jsx(V,{value:"instructions",children:"Instrucciones"})]}),e.jsx(A,{value:"qrcode",className:"space-y-4",children:T?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[300px] bg-muted/20 rounded-lg",children:[e.jsx(_,{className:"h-12 w-12 text-muted-foreground animate-spin"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Generando código QR..."})]}):f?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-4 relative",children:[e.jsx(J,{value:f,size:256,level:"H",includeMargin:!0}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx($,{className:"h-16 w-16 text-primary opacity-70"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Escanee este código con la cámara de su teléfono"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(P,{className:"h-4 w-4 text-primary animate-bounce"}),e.jsx(S,{className:"h-5 w-5 text-primary"}),e.jsx(P,{className:"h-4 w-4 text-primary animate-bounce"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Se abrirá la aplicación de lectura NFC automáticamente"})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:o,className:"flex items-center gap-1",children:R?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:"Copiado"})]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:"Copiar enlace"})]})}),e.jsxs(i,{variant:"outline",size:"sm",onClick:g,className:"flex items-center gap-1",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:"Abrir lector NFC"})]})]})]}):e.jsxs(D,{variant:"destructive",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx(Q,{children:"Error"}),e.jsx(L,{children:"No se pudo generar el código QR. Por favor, refresque la página e intente nuevamente."})]})}),e.jsx(A,{value:"instructions",className:"space-y-4",children:e.jsxs("div",{className:"space-y-4 p-2",children:[e.jsx("h3",{className:"font-medium text-base",children:"Cómo usar este código QR:"}),e.jsxs("ol",{className:"space-y-3 ml-5 list-decimal",children:[e.jsxs("li",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Escanee el código QR"}),e.jsx("p",{className:"text-muted-foreground",children:"Abra la cámara de su teléfono y apunte al código QR mostrado en pantalla."})]}),e.jsxs("li",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Permita abrir la aplicación"}),e.jsx("p",{className:"text-muted-foreground",children:"Su teléfono le pedirá permiso para abrir la aplicación NFC o el navegador."})]}),e.jsxs("li",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Active NFC en su teléfono"}),e.jsx("p",{className:"text-muted-foreground",children:"Si no está activado, el sistema le pedirá que active NFC en su dispositivo."})]}),e.jsxs("li",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Acerque su cédula al teléfono"}),e.jsx("p",{className:"text-muted-foreground",children:"Coloque la cédula de identidad en la parte trasera del teléfono para leer el chip NFC."})]}),e.jsxs("li",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Confirme la lectura"}),e.jsx("p",{className:"text-muted-foreground",children:"Una vez leído el chip, el sistema verificará automáticamente la identidad."})]})]}),e.jsxs(D,{className:"mt-4",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx(Q,{children:"Nota importante"}),e.jsx(L,{children:"La ubicación exacta del sensor NFC varía según el modelo de teléfono. Generalmente se encuentra en la parte central o superior de la parte trasera."})]})]})})]})}),e.jsxs(I,{className:"flex justify-between border-t pt-4",children:[e.jsxs(i,{variant:"outline",onClick:()=>N(),children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Regenerar código"]}),e.jsx(i,{onClick:()=>E(p==="qrcode"?"instructions":"qrcode"),children:p==="qrcode"?"Ver instrucciones":"Ver código QR"})]})]})},oe=()=>{const[u,m]=s.useState("initial"),[t,f]=s.useState(`session-${Date.now()}`),[h,n]=s.useState(0),[l,p]=s.useState(null),[E,R]=s.useState(null),[r,T]=s.useState(null),[q,c]=ee(),{toast:N}=G(),[,o]=se("/verificacion-nfc-puente/result/:sessionId");s.useEffect(()=>{o&&o.sessionId&&!sessionStorage.getItem(`initialized_${o.sessionId}`)&&(sessionStorage.setItem(`initialized_${o.sessionId}`,"true"),g(o.sessionId),f(o.sessionId),m("waiting"))},[o]),s.useEffect(()=>{if(u==="waiting"){const x=setInterval(()=>{n(d=>d<95?d+.5:d)},500);return()=>clearInterval(x)}},[u]),s.useEffect(()=>{if(u==="waiting"){const x=setInterval(()=>{g(t)},3e3);return T(x),()=>{r&&clearInterval(r)}}},[u,t]);const g=async x=>{console.log("Verificando resultados para sesión:",x);try{let d=null;h>80&&(d={documentNumber:"12.345.678-9",fullName:"USUARIO DE DEMO",birthDate:"01/01/1990",expiryDate:"01/01/2030",nationality:"CHILENA",serialNumber:"DEM123456789",issuer:"REGISTRO CIVIL E IDENTIFICACIÓN",verified:!0,timestamp:new Date().toISOString()}),d&&(p(d),n(100),m("complete"),r&&clearInterval(r),N({title:"Verificación completada",description:"Los datos NFC de la cédula han sido recibidos correctamente."}))}catch(d){console.error("Error al verificar los resultados:",d),h>70&&(R("No se pudo conectar con el servidor para verificar los datos NFC."),m("error"),r&&clearInterval(r))}},a=()=>{const x=`session-${Date.now()}`;f(x),m("qr_shown")},v=()=>{n(0),m("waiting"),N({title:"Esperando datos NFC",description:"Por favor, siga las instrucciones en su teléfono móvil."})},j=()=>{r&&clearInterval(r),m("initial"),n(0),p(null),R(null)},H=()=>{switch(u){case"initial":return e.jsxs(C,{className:"w-full max-w-lg mx-auto",children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-6 w-6 text-primary"}),e.jsx(w,{children:"Verificación NFC con Puente Móvil"})]}),e.jsx(y,{children:"Este proceso utiliza su teléfono móvil como puente para leer el chip NFC de la cédula"})]}),e.jsxs(F,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted",children:[e.jsx(S,{className:"h-12 w-12 mx-auto mb-2 text-primary"}),e.jsx("h2",{className:"text-lg font-medium mb-1",children:"Verificación en dos pasos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Este proceso requiere un teléfono con NFC y su cédula de identidad"})]}),e.jsxs(B,{defaultValue:"flow",children:[e.jsxs(O,{className:"grid grid-cols-2",children:[e.jsx(V,{value:"flow",children:"Cómo funciona"}),e.jsx(V,{value:"requirements",children:"Requisitos"})]}),e.jsx(A,{value:"flow",className:"space-y-4 p-1",children:e.jsxs("div",{className:"flex flex-col space-y-3 mt-2",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full min-w-10 min-h-10 flex items-center justify-center",children:e.jsx("span",{className:"text-primary font-bold",children:"1"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Escanee el código QR"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Con la cámara de su teléfono escanee el código que se mostrará"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full min-w-10 min-h-10 flex items-center justify-center",children:e.jsx("span",{className:"text-primary font-bold",children:"2"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Active NFC y lea su cédula"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Siga las instrucciones en su teléfono para activar NFC y leer la cédula"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full min-w-10 min-h-10 flex items-center justify-center",children:e.jsx("span",{className:"text-primary font-bold",children:"3"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Reciba los datos verificados"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Los datos NFC de su cédula serán enviados automáticamente a esta página"})]})]})]})}),e.jsx(A,{value:"requirements",className:"space-y-4 p-1",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium",children:"Requisitos para completar la verificación:"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Teléfono con NFC activado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"La mayoría de los teléfonos modernos tienen esta función"})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Cédula de identidad con chip"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Su cédula debe incluir un chip NFC para ser leída"})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Cámara para escanear QR"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Para iniciar el proceso con el código QR"})]})]})]})]})})]})]}),e.jsxs(I,{className:"flex flex-col gap-2",children:[e.jsx(i,{className:"w-full",onClick:a,children:"Iniciar verificación NFC"}),e.jsx(i,{variant:"secondary",className:"w-full",onClick:()=>c("/verificacion-avanzada"),children:"Volver al inicio"})]})]});case"qr_shown":return e.jsxs("div",{className:"w-full max-w-lg mx-auto",children:[e.jsx(ce,{sessionId:t}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(i,{onClick:v,children:"Continuar"})})]});case"waiting":return e.jsxs(C,{className:"w-full max-w-lg mx-auto",children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-primary animate-spin"}),e.jsx(w,{children:"Esperando datos NFC"})]}),e.jsx(U,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"En proceso"})]}),e.jsx(y,{children:"Por favor complete el proceso en su teléfono móvil"})]}),e.jsxs(F,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx(te,{className:"h-10 w-10 text-muted-foreground"}),e.jsx(M,{className:"h-6 w-6 text-primary animate-pulse"}),e.jsx(S,{className:"h-10 w-10 text-primary"}),e.jsx(M,{className:"h-6 w-6 text-primary animate-pulse"}),e.jsx(ie,{className:"h-10 w-10 text-green-500"})]}),e.jsx("h3",{className:"text-lg font-medium",children:"Leyendo datos de la cédula"}),e.jsx("p",{className:"text-muted-foreground",children:"Siga las instrucciones en su teléfono para completar la lectura NFC"}),e.jsx(re,{value:h,className:"h-2 mt-6"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Esperando datos... (",Math.round(h),"%)"]})]}),e.jsxs(D,{className:"bg-blue-50 border-blue-200",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx(Q,{children:"Verifique su teléfono"}),e.jsx(L,{children:"Asegúrese de seguir todos los pasos en su teléfono móvil y mantener la página abierta hasta completar el proceso."})]})]}),e.jsxs(I,{className:"flex justify-between border-t pt-4",children:[e.jsx(i,{variant:"ghost",onClick:j,children:"Cancelar"}),e.jsx(i,{variant:"outline",onClick:()=>g(t),children:"Verificar estado"})]})]});case"complete":return e.jsxs(C,{className:"w-full max-w-lg mx-auto",children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5 text-primary"}),e.jsx(w,{children:"Verificación completada"})]}),e.jsx(U,{variant:"outline",className:"bg-green-50 text-green-700",children:"VERIFICADO"})]}),e.jsx(y,{children:"Los datos NFC de la cédula han sido verificados correctamente"})]}),e.jsxs(F,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-lg bg-green-50 border border-green-200",children:[e.jsx(k,{className:"h-10 w-10 mx-auto mb-2 text-green-500"}),e.jsx("h2",{className:"text-lg font-medium text-green-700",children:"Verificación exitosa"}),e.jsx("p",{className:"text-sm text-green-600",children:"Se ha validado correctamente la autenticidad de la cédula de identidad"})]}),l&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Datos verificados:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded bg-muted",children:[e.jsx("p",{className:"font-medium",children:"Documento"}),e.jsx("p",{children:l.documentNumber})]}),e.jsxs("div",{className:"p-2 rounded bg-muted",children:[e.jsx("p",{className:"font-medium",children:"Nombre"}),e.jsx("p",{children:l.fullName})]}),e.jsxs("div",{className:"p-2 rounded bg-muted",children:[e.jsx("p",{className:"font-medium",children:"Fecha de nacimiento"}),e.jsx("p",{children:l.birthDate})]}),e.jsxs("div",{className:"p-2 rounded bg-muted",children:[e.jsx("p",{className:"font-medium",children:"Nacionalidad"}),e.jsx("p",{children:l.nationality})]}),e.jsxs("div",{className:"p-2 rounded bg-muted",children:[e.jsx("p",{className:"font-medium",children:"Fecha expiración"}),e.jsx("p",{children:l.expiryDate})]}),e.jsxs("div",{className:"p-2 rounded bg-muted",children:[e.jsx("p",{className:"font-medium",children:"Autoridad emisora"}),e.jsx("p",{children:l.issuer})]}),e.jsxs("div",{className:"col-span-2 p-2 rounded bg-muted",children:[e.jsx("p",{className:"font-medium",children:"Serial NFC"}),e.jsx("p",{className:"font-mono text-xs",children:l.serialNumber})]})]})]})]}),e.jsxs(I,{className:"flex-col gap-2",children:[e.jsx(i,{className:"w-full",onClick:j,children:"Nueva verificación"}),e.jsx(i,{variant:"outline",className:"w-full",onClick:()=>c("/verificacion-avanzada"),children:"Volver a verificación"})]})]});case"error":return e.jsxs(C,{className:"w-full max-w-lg mx-auto",children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5 text-destructive"}),e.jsx(w,{children:"Error de verificación"})]}),e.jsx(y,{children:"No se pudo completar la verificación NFC"})]}),e.jsxs(F,{children:[e.jsxs(D,{variant:"destructive",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(Q,{children:"Error"}),e.jsx(L,{children:E||"Se produjo un error durante la verificación NFC."})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Posibles soluciones:"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1 text-sm",children:[e.jsx("li",{children:"Asegúrese de que el NFC está activado en su teléfono"}),e.jsx("li",{children:"Verifique que su cédula tiene chip NFC y está en buen estado"}),e.jsx("li",{children:"Intente posicionar la cédula en diferentes posiciones sobre el teléfono"}),e.jsx("li",{children:"Compruebe que no hay interferencias metálicas cerca"})]})]})]}),e.jsxs(I,{className:"flex-col gap-2",children:[e.jsx(i,{className:"w-full",onClick:j,children:"Reintentar"}),e.jsx(i,{variant:"outline",className:"w-full",onClick:()=>c("/verificacion-avanzada"),children:"Volver a verificación"})]})]})}};return e.jsx("div",{className:"container py-6 max-w-4xl mx-auto",children:e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[80vh]",children:H()})})};export{oe as default};
