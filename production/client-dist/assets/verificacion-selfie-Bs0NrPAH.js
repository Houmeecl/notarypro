import{u as T,p as k,r,j as e,d as R,v as S,x as D,z as V,e as I,V as M,a as n,_ as F}from"./index-BPC64rrb.js";function L(){const{toast:c}=T(),[,h]=k(),[i,g]=r.useState(!1),[v,l]=r.useState(!1),[d,x]=r.useState(!1),[u,p]=r.useState(null),[j,y]=r.useState(null),o=r.useRef(null),f=r.useRef(null),s=r.useRef(null);r.useEffect(()=>(b(),()=>{s.current&&s.current.getTracks().forEach(t=>t.stop())}),[]);const b=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}}});o.current&&(o.current.srcObject=t,s.current=t,l(!0),y(null))}catch(t){console.error("Error al acceder a la cámara:",t),y("No se pudo acceder a la cámara. Por favor, asegúrate de dar permiso a la cámara y que no esté siendo utilizada por otra aplicación."),l(!1)}},C=()=>{if(!o.current||!f.current||!v)return;const t=o.current,a=f.current,N=a.getContext("2d");if(!N)return;a.width=t.videoWidth,a.height=t.videoHeight,N.drawImage(t,0,0,a.width,a.height);const E=a.toDataURL("image/png");p(E),x(!0),s.current&&(s.current.getTracks().forEach(P=>P.stop()),l(!1))},m=()=>{x(!1),p(null),b()},w=async()=>{if(u){g(!0);try{const a=await(await F("POST","/api/identity/verify-selfie",{photo:u})).json();a.success?(c({title:"Éxito",description:"Tu identidad ha sido verificada correctamente"}),setTimeout(()=>{h("/document-selection")},1500)):(c({title:"Error",description:a.message||"No se pudo verificar tu identidad. Por favor, intenta nuevamente.",variant:"destructive"}),m())}catch(t){console.error("Error en la verificación:",t),c({title:"Error",description:"Ha ocurrido un error al procesar tu foto. Por favor, intenta nuevamente.",variant:"destructive"}),m()}finally{g(!1)}}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsxs(R,{className:"w-full max-w-md",children:[e.jsxs(S,{className:"bg-indigo-900 text-white rounded-t-lg",children:[e.jsx(D,{className:"text-xl",children:"Verificación de Identidad"}),e.jsx(V,{className:"text-gray-200",children:"Por favor, captura una foto de tu rostro para verificar tu identidad"})]}),e.jsx(I,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[j&&e.jsx("div",{className:"bg-red-50 text-red-700 p-3 rounded-md text-sm mb-4 w-full",children:j}),e.jsx("div",{className:"relative w-full aspect-video bg-gray-100 rounded-lg overflow-hidden border-2 border-gray-300",children:d?e.jsx("img",{src:u||"",alt:"Foto capturada",className:"w-full h-full object-cover"}):e.jsx("video",{ref:o,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"})}),e.jsx("canvas",{ref:f,style:{display:"none"}}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:d?"¿Estás conforme con esta foto?":"Posiciona tu rostro en el centro y asegúrate de tener buena iluminación"})]})}),e.jsxs(M,{className:"flex justify-between",children:[e.jsx(n,{variant:"outline",onClick:()=>{s.current&&s.current.getTracks().forEach(t=>t.stop()),h("/")},children:"Cancelar"}),d?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{variant:"outline",onClick:m,disabled:i,children:"Tomar Otra"}),e.jsx(n,{onClick:w,disabled:i,className:"bg-green-600 hover:bg-green-700",children:i?"Verificando...":"Verificar Identidad"})]}):e.jsx(n,{onClick:C,disabled:!v||i,className:"bg-indigo-900 hover:bg-indigo-800",children:"Capturar Foto"})]})]})})}export{L as default};
