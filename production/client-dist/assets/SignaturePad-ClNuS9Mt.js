import{r as n,co as N,j as e,d as y,v as E,x as S,bb as R,z as F,e as L,ax as P,bB as k,aA as D,V as A,a as u,bo as B,aB as I}from"./index-BPC64rrb.js";const W=({onSignatureCapture:g,onCancel:m,title:v="Firma Electrónica",description:p="Firme en el recuadro inferior usando su dedo o mouse",clientName:h})=>{const l=n.useRef(null),a=n.useRef(null),[j,f]=n.useState(!1),[o,d]=n.useState(!1),[x,t]=n.useState(null);n.useEffect(()=>{var s;if(!l.current)return;const r=l.current,i=Math.max(window.devicePixelRatio||1,1);return r.width=r.offsetWidth*i,r.height=r.offsetHeight*i,(s=r.getContext("2d"))==null||s.scale(i,i),a.current=new N(r,{minWidth:1,maxWidth:2.5,backgroundColor:"rgba(255, 255, 255, 0)",penColor:"rgb(0, 0, 128)"}),r.addEventListener("mousedown",c),r.addEventListener("touchstart",c),()=>{r&&(r.removeEventListener("mousedown",c),r.removeEventListener("touchstart",c)),a.current=null}},[]);const c=()=>{t(null),a.current&&!a.current.isEmpty()&&f(!0)},b=()=>{a.current&&(a.current.clear(),f(!1),t(null))},w=async()=>{if(a.current){if(a.current.isEmpty()){t("Por favor, firme antes de continuar");return}d(!0);try{const r=a.current.toDataURL("image/png");setTimeout(()=>{(async s=>{try{return{valid:!0,score:.92,signatureId:`sig-${Date.now()}`}}catch(C){throw console.error("Error validating signature:",C),new Error("No se pudo validar la firma")}})(r).then(s=>{s.valid?g(r):t("La firma no pudo ser validada. Por favor, intente nuevamente.")}).catch(s=>{t(s.message||"Error al procesar la firma")}).finally(()=>{d(!1)})},1500)}catch(r){console.error("Error capturando firma:",r),t("Ocurrió un error al capturar la firma"),d(!1)}}};return e.jsxs(y,{className:"w-full",children:[e.jsxs(E,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-[#2d219b]"}),v]}),e.jsx(F,{children:p})]}),e.jsxs(L,{className:"space-y-4",children:[h&&e.jsxs("div",{className:"text-sm font-medium",children:["Firmante: ",e.jsx("span",{className:"text-gray-600",children:h})]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-1 bg-white",children:e.jsx("canvas",{ref:l,className:"w-full h-60 touch-none cursor-crosshair border border-gray-200 rounded"})}),x&&e.jsxs(P,{variant:"destructive",className:"mt-2",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx(D,{children:x})]}),e.jsx("div",{className:"text-xs text-gray-500 italic mt-1",children:"Al firmar este documento, confirma que toda la información proporcionada es correcta y acepta los términos y condiciones."})]}),e.jsxs(A,{className:"flex justify-between",children:[e.jsxs(u,{variant:"outline",onClick:b,disabled:o,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Limpiar"]}),e.jsxs("div",{className:"space-x-2",children:[m&&e.jsx(u,{variant:"ghost",onClick:m,disabled:o,children:"Cancelar"}),e.jsx(u,{className:"bg-[#2d219b] hover:bg-[#241a7d] text-white",onClick:w,disabled:!j||o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-current border-t-transparent rounded-full mr-2"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Firmar"]})})]})]})]})};export{W as default};
