import{o as Q,u as X,r as i,j as e,d as g,ax as d,ay as f,aA as o,ad as P,P as V,a as u,U as D,T as Y,g as J,h as w,k as F,cf as K,az as p,aB as R,af as A,W as Z,aW as ee,_ as q}from"./index-BPC64rrb.js";/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],ae=Q("scroll-text",se),ne=()=>{const{toast:r}=X(),[n,E]=i.useState(null),[c,S]=i.useState(null),[z,m]=i.useState(!1),[v,I]=i.useState(null),[j,t]=i.useState(null),[l,W]=i.useState(null),[M,T]=i.useState("instrucciones"),[H,b]=i.useState(!1),[y,U]=i.useState(""),[C,$]=i.useState(""),[k,L]=i.useState(!1);i.useEffect(()=>{const s=navigator.userAgent.toLowerCase(),a=s.includes("lenovo"),x=/tablet|ipad|playbook|silk|android(?!.*mobile)/i.test(s),h={isLenovo:a,isTablet:x,userAgent:s,screenWidth:window.innerWidth,screenHeight:window.innerHeight,devicePixelRatio:window.devicePixelRatio};W(h)},[]),i.useEffect(()=>{(async()=>{try{(await q("GET","/api/user")).ok&&b(!0)}catch(a){console.error("Error al verificar estado de login:",a)}})()},[]),i.useEffect(()=>{(async()=>{if("NDEFReader"in window){E(!0);try{await new window.NDEFReader().scan(),S(!0)}catch(a){console.error("Error al activar NFC:",a),S(!1)}}else E(!1)})()},[]);const B=async()=>{if(!y||!C){r({variant:"destructive",title:"Error de validación",description:"Por favor, ingresa usuario y contraseña"});return}L(!0),t(null);try{const s=await q("POST","/api/login",{username:y,password:C});if(s.ok){const a=await s.json();b(!0),r({title:"Inicio de sesión exitoso",description:`Bienvenido, ${a.username}`})}else{const a=await s.json().catch(()=>null);t((a==null?void 0:a.message)||"Credenciales incorrectas"),r({variant:"destructive",title:"Error de inicio de sesión",description:"Usuario o contraseña incorrectos"})}}catch{t("Error de conexión al servidor"),r({variant:"destructive",title:"Error de conexión",description:"No se pudo conectar con el servidor"})}finally{L(!1)}},G=async()=>{if(!n||!c){t("NFC no está disponible o activado en este dispositivo");return}m(!0),t(null),I(null);try{const s=new window.NDEFReader;s.addEventListener("reading",({message:a,serialNumber:x})=>{console.log("NFC leído:",x);const h=[];for(const N of a.records)if(N.recordType==="text"){const O=new TextDecoder().decode(N.data);h.push({type:"text",value:O})}else h.push({type:N.recordType,value:"Datos binarios no mostrados",rawData:N.data});I({serialNumber:x,records:h,timestamp:new Date().toISOString()}),m(!1),r({title:"Lectura NFC exitosa",description:`ID: ${x}`})}),s.addEventListener("error",a=>{console.error("Error NFC:",a),t(`Error de lectura NFC: ${a.message}`),m(!1),r({variant:"destructive",title:"Error de lectura NFC",description:a.message})}),await s.scan(),r({title:"Validación Notarial Iniciada",description:"Por favor, acerque su documento de identidad al dispositivo"})}catch(s){console.error("Error al iniciar escaneo NFC:",s),t(`Error al iniciar escaneo NFC: ${s.message}`),m(!1),r({variant:"destructive",title:"Error en Validación Notarial",description:"No se pudo iniciar el sistema de verificación de identidad. Por favor, contacte con soporte técnico."})}},_=()=>{m(!1),r({title:"Verificación Notarial Cancelada",description:"El proceso de validación de identidad ha sido interrumpido"})};return e.jsxs("div",{className:"container max-w-4xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Notaría VecinoXpress"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Sistema oficial de validación de identidad notarial"})]}),H?e.jsxs(Y,{defaultValue:"instrucciones",value:M,onValueChange:T,className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs(J,{className:"grid grid-cols-3",children:[e.jsx(w,{value:"instrucciones",children:"Instrucciones"}),e.jsx(w,{value:"verificacion",children:"Verificación"}),e.jsx(w,{value:"diagnostico",children:"Diagnóstico"})]}),e.jsxs(u,{variant:"outline",onClick:()=>b(!1),size:"sm",className:"flex gap-2 items-center",children:[e.jsx(D,{className:"h-4 w-4"}),"Cerrar sesión"]})]}),e.jsx(F,{value:"instrucciones",children:e.jsxs(g,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(K,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"text-2xl font-semibold",children:"Guía para Verificación Notarial"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-medium mb-2",children:"Preparación"}),e.jsxs("ol",{className:"list-decimal pl-5 space-y-2",children:[e.jsx("li",{children:"Asegúrate de que NFC esté activado en tu tablet (Configuración > Conexiones > NFC)"}),e.jsx("li",{children:"Quita cualquier funda o protector que pueda interferir con la señal"}),e.jsx("li",{children:"Asegúrate de que la batería esté por encima del 15%"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-medium mb-2",children:"Posición correcta de la cédula"}),e.jsx("p",{className:"mb-2",children:"La ubicación de la antena NFC varía según el modelo de tablet:"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Tab M8/M10:"})," Centro de la parte trasera"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Tab P11/P12:"})," Parte superior trasera, cerca de la cámara"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Yoga Tab:"})," Cerca del logo Lenovo en la parte trasera"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-medium mb-2",children:"Consejos para mejor lectura"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-2",children:[e.jsx("li",{children:"Mantén la cédula inmóvil durante 2-3 segundos"}),e.jsx("li",{children:"Prueba diferentes posiciones si no detecta inicialmente"}),e.jsx("li",{children:"Evita superficies metálicas que puedan interferir"}),e.jsx("li",{children:"Si Chrome pide permiso para NFC, acepta"})]})]}),e.jsx(u,{className:"w-full mt-4",onClick:()=>T("verificacion"),children:"Continuar a verificación"})]})}),e.jsx(F,{value:"verificacion",children:e.jsxs(g,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ae,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"text-2xl font-semibold",children:"Verificación de Identidad Notarial"})]}),n===!1&&e.jsxs(d,{variant:"destructive",className:"mb-4",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx(p,{children:"NFC no compatible"}),e.jsx(o,{children:"Este dispositivo no es compatible con NFC o el navegador no soporta Web NFC. Verifica que estés usando Chrome y que hayas activado Web NFC en chrome://flags."})]}),n&&!c&&e.jsxs(d,{variant:"warning",className:"mb-4",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx(p,{children:"NFC desactivado"}),e.jsx(o,{children:"NFC está desactivado en tu dispositivo. Actívalo desde Configuración > Conexiones > NFC y vuelve a cargar esta página."})]}),n&&c&&e.jsxs(d,{variant:"default",className:"mb-4 bg-green-50 border-green-200",children:[e.jsx(R,{className:"h-4 w-4 text-green-500"}),e.jsx(p,{children:"NFC activado y listo"}),e.jsx(o,{children:"Tu dispositivo está listo para leer tarjetas NFC. Presiona el botón para comenzar."})]}),j&&e.jsxs(d,{variant:"destructive",className:"mb-4",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx(p,{children:"Error"}),e.jsx(o,{children:j})]}),e.jsx("div",{className:"flex flex-col items-center justify-center mb-6 p-6 border-2 border-dashed border-gray-300 rounded-lg",children:z?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"animate-pulse flex flex-col items-center mb-4",children:[e.jsx(A,{className:"h-16 w-16 text-primary mb-2"}),e.jsx("p",{className:"text-lg font-medium",children:"Acerque su documento de identidad"})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4 text-center",children:"Mantenga su cédula inmóvil durante 2-3 segundos en contacto con el lector del dispositivo"}),e.jsx(u,{variant:"outline",onClick:_,className:"bg-white hover:bg-gray-50",children:"Cancelar verificación"})]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-16 w-16 text-gray-400 mb-2"}),e.jsx("p",{className:"text-lg font-medium mb-4",children:"Sistema Notarial de Validación"}),e.jsx(u,{onClick:G,disabled:!n||!c,className:"bg-indigo-700 hover:bg-indigo-800 text-white",children:"Iniciar Verificación de Identidad"})]})}),v&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-medium mb-2 flex items-center",children:[e.jsx(R,{className:"h-5 w-5 text-green-600 mr-2"}),"Certificación Notarial Completada"]}),e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-md mb-4",children:e.jsx("p",{className:"text-sm text-green-800",children:"La identidad del ciudadano ha sido verificada exitosamente mediante el sistema notarial VecinoXpress"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between p-2 bg-gray-50 rounded-md",children:[e.jsx("span",{className:"font-medium",children:"Número de Validación:"}),e.jsx("span",{className:"font-mono",children:v.serialNumber})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-gray-50 rounded-md",children:[e.jsx("span",{className:"font-medium",children:"Fecha y Hora:"}),e.jsx("span",{children:new Date(v.timestamp).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-gray-50 rounded-md",children:[e.jsx("span",{className:"font-medium",children:"Tipo de Documento:"}),e.jsx("span",{children:"Cédula de Identidad"})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-gray-50 rounded-md",children:[e.jsx("span",{className:"font-medium",children:"Estado:"}),e.jsx("span",{className:"text-green-600 font-medium",children:"Verificado"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Esta verificación cuenta con validez legal según Ley 19.799 sobre documentos electrónicos y firma electrónica"})})]})]})}),e.jsx(F,{value:"diagnostico",children:e.jsxs(g,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Z,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"text-2xl font-semibold",children:"Diagnóstico de Sistema Notarial"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-medium mb-2",children:"Estado NFC"}),e.jsxs("ul",{className:"list-none space-y-2",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:`inline-block w-4 h-4 rounded-full mr-2 ${n?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:[e.jsx("strong",{children:"Soporte NFC:"})," ",n?"Soportado":"No soportado"]})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:`inline-block w-4 h-4 rounded-full mr-2 ${c?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:[e.jsx("strong",{children:"NFC activado:"})," ",c?"Sí":"No"]})]})]})]}),l&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-medium mb-2",children:"Información del dispositivo"}),e.jsxs("ul",{className:"list-none space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Dispositivo Lenovo:"})," ",l.isLenovo?"Sí":"No"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Es tablet:"})," ",l.isTablet?"Sí":"No"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Resolución pantalla:"})," ",l.screenWidth," x ",l.screenHeight]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Densidad de píxeles:"})," ",l.devicePixelRatio]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-medium mb-2",children:"Solución de problemas"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"font-medium",children:"NFC no detectado:"}),e.jsxs("ul",{className:"list-disc pl-5",children:[e.jsx("li",{children:"Verifica que NFC esté activado en Configuración"}),e.jsx("li",{children:"Reinicia la tablet"}),e.jsx("li",{children:"Asegúrate de usar Chrome actualizado"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"font-medium",children:"Web NFC no disponible:"}),e.jsxs("ul",{className:"list-disc pl-5",children:[e.jsx("li",{children:"Escribe chrome://flags en la barra de direcciones"}),e.jsx("li",{children:'Busca "Web NFC" y actívalo'}),e.jsx("li",{children:"Reinicia Chrome"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"font-medium",children:"Detección inconsistente:"}),e.jsxs("ul",{className:"list-disc pl-5",children:[e.jsx("li",{children:"Prueba diferentes posiciones en la parte trasera"}),e.jsx("li",{children:"Quita fundas o protectores"}),e.jsx("li",{children:"Evita superficies metálicas"})]})]})]})]}),e.jsxs(d,{className:"mb-4",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx(p,{children:"Consejo"}),e.jsx(o,{children:"Si sigues teniendo problemas, descarga la app NFC Tools desde Google Play para verificar si el hardware NFC funciona correctamente."})]})]})})]}):e.jsxs(g,{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Acceso de Notarios y Personal Autorizado"}),e.jsx("p",{className:"mb-4 text-gray-600",children:"Este sistema de validación notarial requiere autenticación para garantizar la seguridad en el proceso de verificación de identidad"}),j&&e.jsxs(d,{variant:"destructive",className:"mb-4",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx(o,{children:j})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"username",children:"Usuario"}),e.jsx(V,{id:"username",type:"text",placeholder:"Tu nombre de usuario",value:y,onChange:s=>U(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"password",children:"Contraseña"}),e.jsx(V,{id:"password",type:"password",placeholder:"Tu contraseña",value:C,onChange:s=>$(s.target.value)})]}),e.jsx(u,{className:"w-full",onClick:B,disabled:k,children:k?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Iniciando sesión..."]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Iniciar sesión"]})})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t text-sm text-gray-500",children:[e.jsx("p",{children:"Credenciales por defecto:"}),e.jsxs("ul",{className:"list-disc pl-5 mt-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Usuario:"})," miadmin"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Contraseña:"})," miadmin123"]})]})]})]})]})};export{ne as default};
