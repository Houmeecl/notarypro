import{r as o,u as $,j as e,T as B,g as R,h as g,k as p,d as v,v as N,x as b,bc as k,z as f,e as y,ax as i,aa as w,az as t,aA as r,b6 as H,ay as x,V as E,a as C,c0 as T,c1 as L,ad as K,P as M,c2 as Q,c3 as U,c4 as X}from"./index-BPC64rrb.js";function J(){const[S,D]=o.useState(null),[c,n]=o.useState(!1),[u,P]=o.useState([]),[m,I]=o.useState(""),[h,q]=o.useState([]),[l,d]=o.useState(null),{toast:a}=$(),F=s=>s.toLocaleDateString("es-CL",{year:"numeric",month:"long",day:"numeric"}),A=async()=>{try{n(!0),d(null);const s=await Q();D(s),a(s?{title:"Extensión detectada",description:"La extensión de firma digital está correctamente instalada"}:{title:"Extensión no detectada",description:"La extensión de firma digital no está disponible",variant:"destructive"})}catch(s){d(s.message||"Error desconocido al verificar la extensión"),a({title:"Error",description:`Error al verificar la extensión: ${s.message}`,variant:"destructive"}),D(!1)}finally{n(!1)}},V=async()=>{try{n(!0),d(null);const s=await U();P(s),s.length===0?a({title:"No se detectaron dispositivos",description:"No se encontraron dispositivos criptográficos conectados",variant:"destructive"}):a({title:"Dispositivos detectados",description:`Se encontraron ${s.length} dispositivo(s)`})}catch(s){d(s.message||"Error desconocido al detectar dispositivos"),a({title:"Error",description:`Error al detectar dispositivos: ${s.message}`,variant:"destructive"})}finally{n(!1)}},z=async()=>{if(!m){a({title:"Error",description:"Debe ingresar un PIN para acceder a los certificados",variant:"destructive"});return}try{n(!0),d(null);const s=await X(m);q(s),s.length===0?a({title:"No se encontraron certificados",description:"El dispositivo no contiene certificados válidos",variant:"destructive"}):a({title:"Certificados encontrados",description:`Se encontraron ${s.length} certificado(s)`})}catch(s){d(s.message||"Error desconocido al obtener certificados"),a({title:"Error",description:`Error al obtener certificados: ${s.message}`,variant:"destructive"})}finally{n(!1)}};return e.jsxs("div",{className:"container max-w-4xl mx-auto py-8 space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Prueba de Dispositivo eToken"}),e.jsx("p",{className:"text-gray-600",children:"Esta herramienta permite comprobar si su dispositivo de firma electrónica está correctamente configurado y listo para usarse con el sistema."}),e.jsxs(B,{defaultValue:"extension",className:"w-full",children:[e.jsxs(R,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsx(g,{value:"extension",children:"Verificar Extensión"}),e.jsx(g,{value:"devices",children:"Detectar Dispositivos"}),e.jsx(g,{value:"certificates",children:"Listar Certificados"})]}),e.jsx(p,{value:"extension",children:e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsxs(b,{className:"flex items-center",children:[e.jsx(k,{className:"h-5 w-5 text-indigo-600 mr-2"}),"Verificar Extensión"]}),e.jsx(f,{children:"Comprueba si la extensión de firma electrónica está instalada en el navegador"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg bg-slate-50",children:[e.jsx("h3",{className:"font-medium mb-2",children:"¿Qué es la extensión de firma electrónica?"}),e.jsx("p",{className:"text-sm text-slate-700 mb-2",children:"La extensión es un componente que permite al navegador comunicarse con dispositivos criptográficos físicos como eTokens, tarjetas inteligentes y otros módulos de hardware de seguridad."}),e.jsx("p",{className:"text-sm text-slate-700",children:"Sin esta extensión, no es posible utilizar la firma electrónica avanzada con dispositivos físicos a través del navegador."})]}),S===!0&&e.jsxs(i,{className:"bg-green-50 border-green-200",children:[e.jsx(w,{className:"h-4 w-4 text-green-600"}),e.jsx(t,{className:"text-green-800",children:"Extensión detectada"}),e.jsx(r,{className:"text-green-700",children:"La extensión de firma electrónica está correctamente instalada y lista para usar."})]}),S===!1&&e.jsxs(i,{className:"bg-red-50 border-red-200",children:[e.jsx(H,{className:"h-4 w-4 text-red-600"}),e.jsx(t,{className:"text-red-800",children:"Extensión no detectada"}),e.jsx(r,{className:"text-red-700",children:"No se detectó la extensión de firma electrónica. Por favor, asegúrese de que está instalada y activa en su navegador."})]}),l&&e.jsxs(i,{className:"bg-red-50 border-red-200",children:[e.jsx(x,{className:"h-4 w-4 text-red-600"}),e.jsx(t,{className:"text-red-800",children:"Error al verificar"}),e.jsx(r,{className:"text-red-700",children:l})]})]}),e.jsx(E,{children:e.jsx(C,{onClick:A,className:"bg-indigo-600 hover:bg-indigo-700",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white rounded-full border-t-transparent mr-2"}),"Verificando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Verificar extensión"]})})})]})}),e.jsx(p,{value:"devices",children:e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsxs(b,{className:"flex items-center",children:[e.jsx(T,{className:"h-5 w-5 text-indigo-600 mr-2"}),"Detectar Dispositivos"]}),e.jsx(f,{children:"Busca dispositivos de firma electrónica conectados al equipo"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg bg-slate-50",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Dispositivos compatibles"}),e.jsx("p",{className:"text-sm text-slate-700 mb-2",children:"Los dispositivos compatibles incluyen tokens USB criptográficos (eToken), tarjetas inteligentes con lectores y otros dispositivos PKCS#11 que almacenan certificados digitales."}),e.jsx("p",{className:"text-sm text-slate-700",children:"Asegúrese de que su dispositivo esté correctamente conectado al equipo antes de realizar la detección."})]}),u.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(i,{className:"bg-green-50 border-green-200",children:[e.jsx(w,{className:"h-4 w-4 text-green-600"}),e.jsx(t,{className:"text-green-800",children:"Dispositivos detectados"}),e.jsx(r,{className:"text-green-700",children:"Se encontraron los siguientes dispositivos:"})]}),e.jsx("div",{className:"ml-2 mt-2",children:e.jsx("ul",{className:"list-disc list-inside space-y-1.5 text-sm ml-4",children:u.map((s,j)=>e.jsx("li",{className:"text-gray-700",children:s},j))})})]}),u.length===0&&!c&&e.jsxs(i,{className:"bg-blue-50 border-blue-200",children:[e.jsx(x,{className:"h-4 w-4 text-blue-600"}),e.jsx(t,{className:"text-blue-800",children:"No se han detectado dispositivos"}),e.jsx(r,{className:"text-blue-700",children:'Haga clic en "Detectar dispositivos" para buscar dispositivos conectados.'})]}),l&&e.jsxs(i,{className:"bg-red-50 border-red-200",children:[e.jsx(x,{className:"h-4 w-4 text-red-600"}),e.jsx(t,{className:"text-red-800",children:"Error al detectar"}),e.jsx(r,{className:"text-red-700",children:l})]})]}),e.jsx(E,{children:e.jsx(C,{onClick:V,className:"bg-indigo-600 hover:bg-indigo-700",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white rounded-full border-t-transparent mr-2"}),"Buscando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Detectar dispositivos"]})})})]})}),e.jsx(p,{value:"certificates",children:e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsxs(b,{className:"flex items-center",children:[e.jsx(L,{className:"h-5 w-5 text-indigo-600 mr-2"}),"Listar Certificados"]}),e.jsx(f,{children:"Muestra los certificados digitales disponibles en el dispositivo"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx(K,{htmlFor:"pin",children:"PIN de acceso"}),e.jsx(M,{id:"pin",type:"password",placeholder:"Ingrese el PIN de su dispositivo",value:m,onChange:s=>I(s.target.value)}),e.jsx("p",{className:"text-xs text-gray-500",children:"Su PIN no se almacena y solo se utiliza para acceder al dispositivo localmente."})]}),h.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(i,{className:"bg-green-50 border-green-200",children:[e.jsx(w,{className:"h-4 w-4 text-green-600"}),e.jsx(t,{className:"text-green-800",children:"Certificados encontrados"}),e.jsxs(r,{className:"text-green-700",children:["Se encontraron ",h.length," certificado(s) en el dispositivo:"]})]}),e.jsx("div",{className:"mt-3 space-y-3",children:h.map((s,j)=>e.jsxs("div",{className:"p-3 border rounded-md bg-white",children:[e.jsx("p",{className:"text-sm font-medium",children:s.subject}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Emisor: ",s.issuer]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Válido hasta: ",F(s.validTo)]}),e.jsxs("p",{className:"text-xs font-mono text-gray-500 mt-1.5 break-all",children:["Serial: ",s.serialNumber]})]},j))})]}),h.length===0&&!c&&e.jsxs(i,{className:"bg-blue-50 border-blue-200",children:[e.jsx(x,{className:"h-4 w-4 text-blue-600"}),e.jsx(t,{className:"text-blue-800",children:"No se han detectado certificados"}),e.jsx(r,{className:"text-blue-700",children:'Ingrese su PIN y haga clic en "Listar certificados" para ver los certificados disponibles.'})]}),l&&e.jsxs(i,{className:"bg-red-50 border-red-200",children:[e.jsx(x,{className:"h-4 w-4 text-red-600"}),e.jsx(t,{className:"text-red-800",children:"Error al listar certificados"}),e.jsx(r,{className:"text-red-700",children:l})]})]}),e.jsx(E,{children:e.jsx(C,{onClick:z,className:"bg-indigo-600 hover:bg-indigo-700",disabled:c||!m,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white rounded-full border-t-transparent mr-2"}),"Consultando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Listar certificados"]})})})]})})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-yellow-800 mb-2",children:"Solución de problemas"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-sm text-yellow-700",children:[e.jsx("li",{children:"Si la extensión no se detecta, asegúrese de haberla instalado desde la tienda de extensiones del navegador"}),e.jsx("li",{children:"Algunos navegadores requieren habilitar manualmente la extensión tras la instalación"}),e.jsx("li",{children:"Si su dispositivo no se detecta, intente desconectarlo y volver a conectarlo"}),e.jsx("li",{children:"Verifique que los controladores del dispositivo estén correctamente instalados en su sistema"}),e.jsx("li",{children:"Si aparece un error de PIN incorrecto, asegúrese de estar utilizando el PIN correcto"}),e.jsx("li",{children:"En caso de bloqueo del PIN, deberá contactar con el proveedor de su dispositivo"})]})]})]})}export{J as default};
